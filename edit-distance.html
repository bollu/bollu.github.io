<!DOCTYPE html><meta charset='UTF-8'><html><head><link rel='stylesheet' href='katex/katex.min.css'    integrity='sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X'    crossorigin='anonymous'><!-- The loading of KaTeX is deferred to speed up page rendering --><link rel='stylesheet' href='prism/prism.css'><title> A Universe of Sorts </title><style>@font-face {font-family: 'Blog Mono'; src: url('/static/iosevka-fixed-extended.ttf');}@font-face {font-family: 'Blog Text'; src: url('/static/Exo2-Regular.ttf');}html { font-size: 100%; }html,body { text-size-adjust: none; -webkit-text-size-adjust: none; -moz-text-size-adjust: none; -ms-text-size-adjust: none; } body { background-color: #FFFFFF; color: #000000;  font-family: 'Blog Text', sans-serif; font-size: 18px; line-height: 1.4em;  max-width: 100%; overflow-x: hidden; }
img { display:block; width: 100%; max-width: 800px; height: auto }.container { overflow-x: auto; overflow-y: hidden;  max-width:100%; }@media (max-width: 480px) { .container { margin-left: 5%; margin-right: 5%; } body { font-size: 30px; } }@media (max-width: 1024px) { .container { margin-left: 5%; margin-right: 5%; } body { font-size: 30px; } }@media (min-width: 1024px) { .container { margin-left: 25%; margin-right: 20%; } }.image { }
a:hover { color: #1a73e8; text-decoration: underline;  }
a { color: #1a73e8; text-decoration: none; }
a:visited { color: #1a73e8; text-decoration: none; }
a:active { color: #1a73e8; text-decoration: none; }

blockquote { margin-left: 0px; margin-right: 0px; } pre, .latexblock, blockquote { border-left-color:#BBB;  border-left-style: solid;      border-left-width: 5px; }pre, blockquote { padding-left: 10px; }
pre { font-family: 'Blog Mono', monospace; font-size: 90%;  }pre {  overflow-x: auto; }.latexblock, blockquote, pre { margin-top: 10px; margin-bottom: 10px; padding-bottom: 5px; padding-top: 5px; background-color: #FFFFFF; }.latexblock { line-height: 1em }
pre, kbd, samp, tt{ font-family:'Blog Mono',monospace; }ul, ol { list-style-position: inside; padding-left: 0; }</style></head><body><div class='container'><h2><a id=edit-distance href='#edit-distance'> ยง </a><span class='centered'> Edit distance</h2>
This implementation of edit distance crystallizes the fact that when computing
edit distance, we only ever move forwards on solving the problem. we <i><span class='centered'>do not</i>
store the results of the overlapping computations, though we could. Rather,
the goal of this implementation is to capture the traversal pattern necessary
for edit distance into a <code>Cursor</code>, and to view the edit distance problem from
the point of view of this <code>Cursor</code>. 
The problem setting is that we have a source string, a destination
string, and we wish to perform operations that convert the source
string into the destination string. The operations allowed are to:
<ul><li><span class='centered'> Insert a character from the destination to the source.</li><li><span class='centered'> Remove a character from the source.</li><li><span class='centered'> Replace a character in the source with a character from the destination.</li></ul>
We want to minimise the number of operations to be used. 
Let's see how we model this.
<pre><code><span class="token comment">{-# LANGUAGE ViewPatterns #-}</span>
<span class="token keyword">type</span> <span class="token constant">Ix</span> <span class="token operator">=</span> <span class="token constant">Int</span><span class="token punctuation">;</span> <span class="token keyword">type</span> <span class="token constant">DestIx</span> <span class="token operator">=</span> <span class="token constant">Ix</span><span class="token punctuation">;</span> <span class="token keyword">type</span> <span class="token constant">SrcIx</span> <span class="token operator">=</span> <span class="token constant">Ix</span><span class="token punctuation">;</span>
<span class="token keyword">data</span> <span class="token constant">Move</span> <span class="token operator">=</span> <span class="token constant">InsertFromDest</span> <span class="token constant">DestIx</span> <span class="token operator">|</span>
            <span class="token constant">RemoveFromSrc</span> <span class="token constant">SrcIx</span> <span class="token operator">|</span>
            <span class="token constant">ReplaceSrcWithDest</span> <span class="token constant">SrcIx</span> <span class="token constant">DestIx</span>
        <span class="token keyword">deriving</span><span class="token punctuation">(</span><span class="token constant">Show</span><span class="token punctuation">)</span>
</code></pre>
Our cost model says that each move costs <code>1</code>. We are charged for every
move we make. We are to minimize the number of operations.
<pre><code><span class="token hvariable">movescost</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">Move</span><span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token constant">Int</span><span class="token punctuation">;</span> <span class="token hvariable">movescost</span> <span class="token operator">=</span> <span class="token builtin">length</span>
</code></pre>
We model this as us having a <code>Cursor</code> which contains  list <code>[a]</code> and information
about where we are in the list as an <code>Ix</code>. 
This is the same as a <code>Zipper</code> for a list, except that in this case, we only
allow ourselves to walk forward. 
<pre><code><span class="token keyword">data</span> <span class="token constant">Cursor</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Cursor</span> <span class="token constant">Ix</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span>
</code></pre>
<ul><li><span class='centered'> <code>cdone</code> tells is if we have completely consumed a cursor.</li><li><span class='centered'> <code>cix</code> tells us the index of the cursor.</li><li><span class='centered'> <code>cval</code> lets us dereference a cursor.</li><li><span class='centered'> <code>incr</code> lets us move a cursor to the next array entry.</li><li><span class='centered'> <code>cursor</code> converts a list into a <code>Cursor</code> at the first index.</li></ul>
<pre><code><span class="token hvariable">cdone</span> <span class="token operator">::</span> <span class="token constant">Cursor</span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token constant">Bool</span><span class="token punctuation">;</span> <span class="token hvariable">cdone</span> <span class="token punctuation">(</span><span class="token constant">Cursor</span> <span class="token hvariable">ix</span> <span class="token hvariable">vs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">ix</span> <span class="token operator">>=</span> <span class="token builtin">length</span> <span class="token hvariable">vs</span>
<span class="token hvariable">cix</span> <span class="token operator">::</span> <span class="token constant">Cursor</span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token constant">Ix</span><span class="token punctuation">;</span> <span class="token hvariable">cix</span> <span class="token punctuation">(</span><span class="token constant">Cursor</span> <span class="token hvariable">ix</span> <span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">ix</span>
<span class="token hvariable">cval</span> <span class="token operator">::</span> <span class="token constant">Cursor</span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token hvariable">a</span><span class="token punctuation">;</span> <span class="token hvariable">cval</span> <span class="token hvariable">c</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token constant">Cursor</span> <span class="token hvariable">ix</span> <span class="token hvariable">vs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">vs</span> <span class="token operator">!!</span> <span class="token hvariable">ix</span>
<span class="token hvariable">incr</span> <span class="token operator">::</span> <span class="token constant">Cursor</span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token constant">Cursor</span> <span class="token hvariable">a</span><span class="token punctuation">;</span> <span class="token hvariable">incr</span> <span class="token punctuation">(</span><span class="token constant">Cursor</span> <span class="token hvariable">ix</span> <span class="token hvariable">vs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token constant">Cursor</span> <span class="token punctuation">(</span><span class="token hvariable">ix</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token hvariable">vs</span>
<span class="token hvariable">cursor</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token constant">Cursor</span> <span class="token hvariable">a</span><span class="token punctuation">;</span> <span class="token hvariable">cursor</span> <span class="token operator">=</span> <span class="token constant">Cursor</span> <span class="token number">0</span>
</code></pre>
We implement <code>edit</code>, that tells us how to edit the source string into
the destination string. The convention is <code>edit <src-str> <dest-str></code>.
<pre><code><span class="token comment">-- | decide how to get ixth character of bs from our as.</span>
<span class="token hvariable">edit</span> <span class="token operator">::</span> <span class="token constant">Eq</span> <span class="token hvariable">a</span> <span class="token operator">=></span> <span class="token constant">Cursor</span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token constant">Cursor</span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token punctuation">[</span><span class="token constant">Move</span><span class="token punctuation">]</span>
</code></pre>
<ul><li><span class='centered'> 1. If both strings have been consumed, then no moves are to be made.</li></ul>
<pre><code><span class="token hvariable">edit</span> <span class="token punctuation">(</span><span class="token hvariable">cdone</span> <span class="token operator">-></span> <span class="token constant">True</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">cdone</span> <span class="token operator">-></span> <span class="token constant">True</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre>
<ul><li><span class='centered'> 2. If the destination string has been fully matched while the source string
   has not, then remove characters from the source string.</li></ul>
<pre><code><span class="token hvariable">edit</span> <span class="token hvariable">a</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token hvariable">cdone</span> <span class="token operator">-></span> <span class="token constant">False</span><span class="token punctuation">)</span> <span class="token hvariable">b</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token hvariable">cdone</span> <span class="token operator">-></span> <span class="token constant">True</span><span class="token punctuation">)</span> <span class="token operator">=</span> 
  <span class="token punctuation">(</span><span class="token constant">RemoveFromSrc</span> <span class="token punctuation">(</span><span class="token hvariable">cix</span> <span class="token hvariable">a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token hvariable">edit</span> <span class="token punctuation">(</span><span class="token hvariable">incr</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token hvariable">b</span>
</code></pre>
<ul><li><span class='centered'> 3. If the source string has run out of characters while the destination string
   still has characters, insert characters from the destination string.</li></ul>
<pre><code><span class="token hvariable">edit</span> <span class="token hvariable">a</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token hvariable">cdone</span> <span class="token operator">-></span> <span class="token constant">True</span><span class="token punctuation">)</span> <span class="token hvariable">b</span><span class="token operator">@</span><span class="token punctuation">(</span><span class="token hvariable">cdone</span> <span class="token operator">-></span> <span class="token constant">False</span><span class="token punctuation">)</span> <span class="token operator">=</span> 
  <span class="token punctuation">(</span><span class="token constant">InsertFromDest</span> <span class="token punctuation">(</span><span class="token hvariable">cix</span> <span class="token hvariable">b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token hvariable">edit</span> <span class="token hvariable">a</span> <span class="token punctuation">(</span><span class="token hvariable">incr</span> <span class="token hvariable">b</span><span class="token punctuation">)</span>
</code></pre>
<ul><li><span class='centered'> 4. Otherwise, we have characters remaining in both strings. Try the
   options of (1) replacing a source character with a destination 
   character (2) removing a character from the source and continuing,
   and (3) if the current characters match, then keep the match and try
   to combine characters that come later in the string. We pick the
   best out of these using the <code>argmin</code> combinator.</li></ul>
<pre><code><span class="token hvariable">edit</span> <span class="token hvariable">a</span> <span class="token hvariable">b</span> <span class="token operator">=</span>  
  <span class="token keyword">let</span> <span class="token hvariable">nomatch</span> <span class="token operator">=</span> <span class="token hvariable">argmin</span> <span class="token hvariable">movescost</span> 
                <span class="token punctuation">(</span><span class="token constant">ReplaceSrcWithDest</span> <span class="token punctuation">(</span><span class="token hvariable">cix</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">cix</span> <span class="token hvariable">b</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token hvariable">edit</span> <span class="token punctuation">(</span><span class="token hvariable">incr</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">incr</span> <span class="token hvariable">b</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">(</span><span class="token constant">RemoveFromSrc</span> <span class="token punctuation">(</span><span class="token hvariable">cix</span> <span class="token hvariable">a</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token hvariable">edit</span> <span class="token punctuation">(</span><span class="token hvariable">incr</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> 
  <span class="token keyword">in</span> <span class="token keyword">case</span> <span class="token hvariable">cval</span> <span class="token hvariable">a</span> <span class="token operator">==</span> <span class="token hvariable">cval</span> <span class="token hvariable">b</span> <span class="token keyword">of</span>
      <span class="token constant">True</span> <span class="token operator">-></span> <span class="token hvariable">argmin</span> <span class="token hvariable">movescost</span> <span class="token hvariable">nomatch</span> <span class="token punctuation">(</span><span class="token hvariable">edit</span> <span class="token punctuation">(</span><span class="token hvariable">incr</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">incr</span> <span class="token hvariable">b</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token constant">False</span> <span class="token operator">-></span> <span class="token hvariable">nomatch</span> 
</code></pre>
      
The helper used for finding minimum according to a cost model.
<pre><code><span class="token hvariable">argmin</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token constant">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token hvariable">a</span>
<span class="token hvariable">argmin</span> <span class="token hvariable">f</span> <span class="token hvariable">a</span> <span class="token hvariable">a</span>' <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token hvariable">f</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token hvariable">f</span> <span class="token hvariable">a</span>'<span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token hvariable">a</span> <span class="token keyword">else</span> <span class="token hvariable">a</span>'
</code></pre>
</container></body></html>